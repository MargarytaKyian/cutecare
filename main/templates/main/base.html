{% load static %}

<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}CuteCare-PetShop by MargoKyian{% endblock %}</title>
    <meta name="title" content="CuteCare-PetShop by MargoKyian">
    <meta name="description" content="This is an eCommerce WebSite for PetShop by MargoKyian!">

    <!-- Icon/Shortcut SVG format -->
    <link rel="shortcut icon" href="{% static 'img/iconweb.svg' %}" type="image/svg+xml">

    <!-- TailwindCSS CDN -->
    <script defer src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

    <!-- Alpine JS -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"/>

    <!-- AOS (animations) CDN -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/style.css' %}"/>

    <style>
        #page-preloader-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #f9fafb;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999; 
            opacity: 1;
            transition: opacity 0.5s ease-out; 
        }

        #page-preloader-container.preloader-hidden {
            opacity: 0;
        }

        .preloader-paw-icon {
            color: #4f46e5; 
            font-size: 3.75rem;
            line-height: 1; 
            animation: preloader-pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        .preloader-text-message {
            margin-top: 1rem;
            color: #4338ca;
            font-weight: 600; 
            font-size: 1.125rem;
        }

        @keyframes preloader-pulse {
          0%, 100% { opacity: 1; transform: scale(1); }
          50% { opacity: 0.6; transform: scale(0.95); }
        }

        html.is-preloading body {
            visibility: hidden;
        } 

    </style>

</head>
<body class="bg-gray-50 min-h-screen flex flex-col">

    <div id="page-preloader-container">
        <i class="fa-solid fa-paw preloader-paw-icon"></i>
        <p class="preloader-text-message">Завантаження...</p>
    </div>

    <nav class="bg-white shadow-md sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">

                <div class="flex-shrink-0 flex items-center -mt-2">
                    <a href="/" class="text-2xl font-bold text-indigo-600">CuteCare</a>
                </div>

                <div class="hidden sm:flex sm:flex-1 sm:items-center sm:justify-between sm:ml-6">
                    <div class="flex items-center space-x-4 md:space-x-6">
                        <a href="/" class="text-gray-700 hover:text-indigo-600 text-sm font-medium">Головна</a>
                        <a href="/shop" class="text-gray-700 hover:text-indigo-600 text-sm font-medium">Каталог</a>
                        <div class="relative flex items-center" x-data="{ open: false }">
                            <button id="categories-button" @click="open = !open" class="text-gray-700 hover:text-indigo-600 text-sm font-medium flex items-center">
                                <span>Категорії</span>
                                <i class="fas fa-chevron-down ml-1 text-xs transition-transform duration-200 ease-in-out" :class="{ 'rotate-180': open }"></i>
                            </button>
                            <div id="categories-menu"
                                 x-show="open"
                                 @click.away="open = false"
                                 x-transition:enter="transition ease-out duration-100"
                                 x-transition:enter-start="transform opacity-0 scale-95"
                                 x-transition:enter-end="transform opacity-100 scale-100"
                                 x-transition:leave="transition ease-in duration-75"
                                 x-transition:leave-start="transform opacity-100 scale-100"
                                 x-transition:leave-end="transform opacity-0 scale-95"
                                 class="origin-top-left absolute top-full left-0 mt-1 w-auto min-w-[12rem] max-h-80 overflow-y-auto rounded-md shadow-lg bg-white z-30 focus:outline-none"
                                 style="display: none;" role="menu" aria-orientation="vertical" aria-labelledby="categories-button">
                                <div class="py-1">
                                    <a href="{% url 'main:product_list' %}"
                                       class="block px-4 py-2 text-sm text-gray-700 hover:bg-indigo-500 hover:text-white animate-on-scroll {% if not category %}bg-indigo-50 text-indigo-700{% endif %}"
                                       role="menuitem">
                                        Всі категорії
                                    </a>
                                    {% if categories %}
                                        {% for c in categories %}
                                        <a href="{{ c.get_absolute_url }}"
                                           class="block px-4 py-2 text-sm text-gray-700 hover:bg-indigo-500 hover:text-white animate-on-scroll {% if category.slug == c.slug %}bg-indigo-50 text-indigo-700{% endif %}"
                                           role="menuitem">
                                            {{ c.name }}
                                        </a>
                                        {% endfor %}
                                    {% else %}
                                        <span class="block px-4 py-2 text-sm text-gray-500">Категорії не знайдено</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <a href="/services" class="text-gray-700 hover:text-indigo-600 text-sm font-medium">Послуги</a>
                        <a href="/chat" class="text-gray-700 hover:text-indigo-600 text-sm font-medium">Ai-бот</a>
                        <a href="{% url "main:about_page" %}" class="text-gray-700 hover:text-indigo-600 text-sm font-medium">Про нас</a>
                    </div>

                    <div class="w-auto md:w-1/2 lg:w-2/5 xl:w-1/3 ml-4">
                        <form id="search-form" action="{% url 'main:product_search' %}" method="get" class="relative flex items-center">
                            <input type="text" id="search-input" name="q" placeholder="Пошук товарів…" autocomplete="off" class="w-full py-2 pl-4 pr-10 rounded-full 
                            border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm">
                            <button type="submit" class="absolute right-0 top-0 bottom-0 px-3 py-2 text-gray-500 hover:text-indigo-600 focus:outline-none" aria-label="Пошук">
                                <i class="fas fa-search"></i>
                            </button>
                            <div id="suggestions" class="absolute w-full mt-1 top-full bg-white border border-gray-300 rounded-lg shadow-lg hidden z-20"></div>
                        </form>
                    </div>
                </div>

                <div class="flex items-center ml-auto space-x-2 sm:space-x-3">

                    {% if user.is_authenticated %}
                    <a href="{% url 'favorite:favorite_list' %}"
                        id="favorites-navbar-icon"
                        class="inline-flex relative items-center justify-center p-2 rounded-full text-gray-700 hover:text-white 
                        hover:bg-rose-500 focus:outline-none cursor-pointer">
                        <i class="fas fa-heart text-xl"></i>
                        <span id="favorites-navbar-count" class="absolute top-0 right-0 inline-flex items-center justify-center px-1.5 py-0.5 text-[10px] 
                        font-bold leading-none text-white bg-indigo-500 rounded-full transform translate-x-1/2 -translate-y-1/2">
                            {% with favourite_quantity=favorite|length %}{{ favourite_quantity|default:0 }}{% endwith %}
                        </span>
                    </a>
                    {% endif %}

                    {% if user.is_authenticated %}
                    <a href="{% url 'cart:cart_detail' %}"
                       id="cart-navbar-icon"
                       class="inline-flex relative items-center justify-center p-2 rounded-full text-gray-700 hover:text-white 
                       hover:bg-indigo-600 focus:outline-none cursor-pointer">
                        <i class="fas fa-shopping-cart text-xl"></i>
                        <span id="cart-navbar-count" class="absolute top-0 right-0 inline-flex items-center justify-center px-1.5 py-0.5 
                        text-[10px] font-bold leading-none text-white bg-indigo-500 rounded-full transform translate-x-1/2 -translate-y-1/2">
                            {% with cart_quantity=cart|length %}{{ cart_quantity|default:0 }}{% endwith %}
                        </span>
                    </a>
                    {% endif %}

                    <div class="hidden sm:flex items-center">
                    {% if user.is_authenticated %}
                        <div class="relative" x-data="{ openDesktopProfile: false }">
                            <button id="profile-button" @click="openDesktopProfile = !openDesktopProfile" class="flex text-sm rounded-full 
                            focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-100 
                            focus:ring-indigo-500 cursor-pointer" aria-expanded="false" :aria-expanded="openDesktopProfile.toString()">
                                <span class="sr-only">Відкрити меню користувача</span>
                                {% if user.image %}
                                    <img class="h-8 w-8 rounded-full object-cover" src="{{ user.image.url }}" alt="User avatar">
                                {% else %}
                                    <span class="inline-flex items-center justify-center h-8 w-8 rounded-full bg-indigo-500">
                                        <i class="fas fa-user text-white text-sm"></i>
                                    </span>
                                {% endif %}
                            </button>
                            <div id="profile-menu"
                              x-show="openDesktopProfile"
                              @click.away="openDesktopProfile = false"
                                 x-transition:enter="transition ease-out duration-100"
                                 x-transition:enter-start="transform opacity-0 scale-95"
                                 x-transition:enter-end="transform opacity-100 scale-100"
                                 x-transition:leave="transition ease-in duration-75"
                                 x-transition:leave-start="transform opacity-100 scale-100"
                                 x-transition:leave-end="transform opacity-0 scale-95"
                                 class="origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white z-30 focus:outline-none"
                                 style="display: none;" role="menu" aria-orientation="vertical" aria-labelledby="profile-button">
                                <div class="py-1" role="none"> <a href="{% url 'users:profile' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-indigo-500 
                                    hover:text-white animate-on-scroll bg-indigo-50 text-indigo-700" role="menuitem" tabindex="-1" id="user-menu-item-0">Профіль</a>
                                    <a href="{% url 'appointments:appointment_history' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-indigo-500 
                                    hover:text-white animate-on-scroll" role="menuitem" tabindex="-1" id="user-menu-item-1">Записи</a>
                                    <a href="{% url 'orders:order_history' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-indigo-500 
                                    hover:text-white animate-on-scroll" role="menuitem" tabindex="-1" id="user-menu-item-1">Замовлення</a>
                                    <form method="post" action="{% url 'users:logout' %}" role="none"> {% csrf_token %}
                                        <button type="submit" class="block w-full text-left px-4 py-2 text-sm text-gray-700 
                                        hover:bg-indigo-500 hover:text-white animate-on-scroll" role="menuitem" tabindex="-1" id="user-menu-item-3">Вийти</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                        {% else %}
                        <div class="flex items-center space-x-2">
                            <a href="{% url 'users:login' %}" class="text-sm font-medium text-gray-700 hover:text-indigo-600 px-3 py-2 rounded-md hover:bg-gray-100">Увійти</a>
                            <a href="{% url 'users:registration' %}" class="text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 px-3 py-2 rounded-md">Реєстрація</a>
                        </div>
                        {% endif %}
                    </div>
                    <div class="flex sm:hidden">
                        <button id="mobile-menu-button" class="inline-flex items-center justify-center p-2 rounded-md
                         text-gray-700 hover:text-white hover:bg-indigo-600 focus:outline-none cursor-pointer">
                            <span class="sr-only">Відкрити головне меню</span>
                            <svg class="h-6 w-6 block" stroke="currentColor" fill="none" viewBox="0 0 24 24" id="open-icon">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                            </svg>
                            <svg class="h-6 w-6 hidden" stroke="currentColor" fill="none" viewBox="0 0 24 24" id="close-icon">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="mobile-menu" class="sm:hidden hidden">
            <div class="px-2 pt-2 pb-3 space-y-1">
                <div class="mt-3 px-3">
                    <input type="text" id="mobile-search-input" placeholder="Пошук..." class="w-full py-2 pl-4 pr-10 rounded-lg 
                    border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" autocomplete="off">
                    <div id="mobile-suggestions" class="absolute w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg hidden z-10"></div>
                </div>
                <a href="/" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-indigo-600 hover:text-white">Головна</a>
                <a href="/shop" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-indigo-600 hover:text-white">Каталог</a>
                <div class="relative" x-data="{ open: false }">
                <button
                    id="mobile-categories-button"
                    @click="open = !open"
                    class="w-full text-left px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-indigo-600 
                    hover:text-white flex justify-between items-center focus:outline-none"
                >
                    <span>Категорії</span>
                    <i
                        class="fas ml-2 text-xs transition-transform duration-200 ease-in-out"
                        :class="{ 'fa-chevron-up': open, 'fa-chevron-down': !open }"
                    ></i>
                </button>
                <div
                    id="mobile-categories-menu"
                    x-show="open"
                    x-transition:enter="transition ease-out duration-100"
                    x-transition:enter-start="transform opacity-0 scale-95"
                    x-transition:enter-end="transform opacity-100 scale-100"
                    x-transition:leave="transition ease-in duration-75"
                    x-transition:leave-start="transform opacity-100 scale-100"
                    x-transition:leave-end="transform opacity-0 scale-95"
                    class="mt-1 space-y-1 px-3 relative z-20 bg-gray-50 py-2"
                    style="display: none;" >
                    <a href="{% url 'main:product_list' %}"
                       class="block px-3 py-2 rounded-md text-sm {% if not category %}text-indigo-700 bg-indigo-100 font-semibold{% else %}text-gray-700 
                       hover:bg-indigo-100 hover:text-indigo-700 font-medium{% endif %}"
                       role="menuitem">
                        Всі категорії
                    </a>
                    {% if categories %}
                        {% for c in categories %}
                        <a href="{{ c.get_absolute_url }}"
                           class="block px-3 py-2 rounded-md text-sm {% if category.slug == c.slug %}text-indigo-700 bg-indigo-100 font-semibold{% else %}text-gray-700 
                           hover:bg-indigo-100 hover:text-indigo-700 font-medium{% endif %}"
                           role="menuitem">
                            {{ c.name }}
                        </a>
                        {% endfor %}
                    {% else %}
                        <span class="block px-3 py-2 text-sm text-gray-500">Категорії не знайдено</span>
                    {% endif %}
                </div>
            </div>
                <a href="/services" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-indigo-600 hover:text-white">Послуги</a>
                <a href="/chat" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-indigo-600 hover:text-white">Ai-бот</a>
                <a href="/about" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-indigo-600 hover:text-white">Про нас</a>
            </div>
            {% if user.is_authenticated %}
            <div x-data="{ open: false }" class="border-t border-gray-200">
                <button @click="open = !open" class="flex items-center justify-between w-full px-4 py-3 text-left focus:outline-none hover:bg-gray-100">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            {% if user.image %}
                                <img class="h-10 w-10 rounded-full object-cover" src="{{ user.image.url }}" alt="User avatar">
                            {% else %}
                                <span class="inline-flex items-center justify-center h-10 w-10 rounded-full bg-indigo-500">
                                    <i class="fas fa-user text-white"></i>
                                </span>
                            {% endif %}
                        </div>
                        <div class="ml-3">
                            <div class="text-base font-medium text-gray-800">{{ user.get_full_name|default:user.username }}</div>
                            <div class="text-sm font-medium text-gray-500">{{ user.email }}</div>
                        </div>
                    </div>
                    <i class="fas text-gray-400 ml-2 transition-transform duration-200 ease-in-out" :class="{ 'fa-chevron-up': open, 'fa-chevron-down': !open }"></i>
                </button>
                <div x-show="open"
                     x-transition:enter="transition ease-out duration-100"
                     x-transition:enter-start="transform opacity-0 scale-95"
                     x-transition:enter-end="transform opacity-100 scale-100"
                     x-transition:leave="transition ease-in duration-75"
                     x-transition:leave-start="transform opacity-100 scale-100"
                     x-transition:leave-end="transform opacity-0 scale-95"
                     class="pb-3 px-2 space-y-1 bg-gray-50"
                     style="display: none;"
                >
                    <a href="{% url 'users:profile' %}" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-indigo-100 hover:text-indigo-700">Профіль</a>
                    <a href="{% url 'appointments:appointment_history' %}" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-indigo-100 hover:text-indigo-700">Записи</a>
                    <a href="{% url 'orders:order_history' %}" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-indigo-100 hover:text-indigo-700">Замовлення</a>
                    <form method="post" action="{% url 'users:logout' %}"> {% csrf_token %}
                        <button type="submit" class="block w-full text-left px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-indigo-100 hover:text-indigo-700">Вийти</button>
                    </form>
                </div>
            </div>
            {% else %}
            <div class="py-3 px-2 border-t border-gray-200">
                <a href="{% url 'users:login' %}" class="block w-full text-center px-3 py-2 mb-2 rounded-md text-base font-medium text-indigo-600 hover:bg-indigo-50 hover:text-indigo-700 border border-indigo-600">Увійти</a>
                <a href="{% url 'users:registration' %}" class="block w-full text-center px-3 py-2 rounded-md text-base font-medium text-white bg-indigo-600 hover:bg-indigo-700">Реєстрація</a>
            </div>
            {% endif %}
        </div>
    </nav>

    <main class="w-full flex-grow">
        {% block content %}
        {% endblock %}
    </main>

    <footer class="bg-black shadow-md">
        <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 text-center text-gray-500 text-sm">
            &copy; {% now "Y" %} CuteCare. Усі права захищені.
        </div>
    </footer>

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        AOS.init({
            duration: 800,
            once: true
        });

        window.addEventListener('load', function() {
            const preloader = document.getElementById('page-preloader-container');
            const htmlEl = document.documentElement;

            if (preloader) {
                setTimeout(function() {
                    preloader.classList.add('preloader-hidden'); 
                    setTimeout(function() {
                        preloader.style.display = 'none';
                        if (htmlEl.classList.contains('is-preloading')) { 
                            htmlEl.classList.remove('is-preloading');
                            document.body.style.visibility = 'visible';
                        }
                    }, 300);
                }, 100);
            } else {
                if (htmlEl.classList.contains('is-preloading')) {
                    htmlEl.classList.remove('is-preloading');
                }
            }
        });
    </script>
    <script>const AUTOCOMPLETE_URL = "{% url 'main:autocomplete' %}";</script>
    <script src="{% static 'js/script.js' %}"></script>
    <script src="{% static 'js/search.js' %}"></script>
</body>
</html>